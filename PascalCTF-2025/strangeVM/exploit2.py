#check flag hardoced in the binary
final_flag_mem_check = [0x56, 0x4c, 0x75, 0x5c, 0x38, 0x6d, 0x39, 0x58, 0x6c, 0x28, 0x3e, 0x57, 0x7b, 0x5f, 0x3f, 0x54, 0x44, 0x5b, 0x71, 0x20, 0x82, 0x1b, 0x8b, 0x50, 0x80, 0x46, 0x7e, 0x15, 0x8a, 0x57, 0x7d, 0x5a, 0x50, 0x54, 0x81, 0x51, 0x8c, 0x0c, 0x94, 0x44, 0x00]


with open("code.pascal", "rb") as f:
    code = f.read()

zeroes_input = [0] * len(final_flag_mem_check)

mem =[0] * 1024
i = 0
user_input_i = 0
while (i < len(code)):  
    
    if (code[i] == 6):  #[ 06 ] [ AA BB CC DD ] [ JJ ] sarebbe un JZ
        mem_write_addr = int.from_bytes(code[i+1:i+5], 'little')
        bytes_to_jump = code[i+5]
        
        #Current Position + 6 (Instruction Size) + 12 (Offset)
        i+=6

        if (mem[mem_write_addr] == 0):
            i += bytes_to_jump      
        continue
    if(code[i] == 5):   #[ 05 ] [ AA BB CC DD ] example instruction read user input (5 bytes)
        mem_write_addr = int.from_bytes(code[i+1:i+5], 'little')        
        
        element = 0
        if (user_input_i < len(zeroes_input)):      
            element = zeroes_input[user_input_i]    
            user_input_i += 1
        mem[mem_write_addr] = element
        i += 5
        continue
    if(code[i] == 4):   #[ 04 ] [ AA BB CC DD ] [ VV ] 6 bytes MOV
        mem_write_addr = int.from_bytes(code[i+1:i+5], 'little')
        element = code[i+5]
        mem[mem_write_addr] = element
        i += 6
        continue
    if(code[i] == 3):   #[ 03 ] [ AA BB CC DD ] [ VV ] 6 bytes MOD
        mem_write_addr = int.from_bytes(code[i+1:i+5], 'little')
        element = code[i+5]
        mem[mem_write_addr] %= element      
        i += 6
        continue
    if(code[i] == 2):   #[ 02 ] [ AA BB CC DD ] [ VV ] 6 bytes SUB.
        mem_write_addr = int.from_bytes(code[i+1:i+5], 'little')
        element = code[i+5]
        mem[mem_write_addr] = (mem[mem_write_addr] - element) & 0xFF
        i += 6
        continue
    if(code[i] == 1):   #[ 01 ] [ AA BB CC DD ] [ VV ] 6 bytes ADD.
        mem_write_addr = int.from_bytes(code[i+1:i+5], 'little')
        element = code[i+5]
        mem[mem_write_addr] = (mem[mem_write_addr] + element) & 0xFF
        i += 6
        continue
    if (code[i] == 0): 
        break

    i += 1

#our case:
#Input + Modification = Output
#Flag + Modification = Target_Mem

# 0 + Modification = result_mem (Since we input 0, the result we see IS the Modification itself.)
# Flag + result_mem = Target_mem
# Flag = target_mem - result_mem
flag = ""
for i in range(len(final_flag_mem_check) - 1):

    target_mem_value = final_flag_mem_check[i]
    target_result_value = mem[i]

    diff = (target_mem_value - target_result_value) & 0xFF
    flag+= chr(diff)

print(flag)